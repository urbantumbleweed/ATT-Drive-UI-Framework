function RunSpanMessageBroker(){if("WebSocket"in window){console.log("WebSocket is supported by your Browser!");var e="ws://"+properties.host+":"+properties.port+"/",o=new WebSocket(e);o.onopen=function(){console.log("Web Scoket is connected now")},o.onmessage=function(e){console.log("Received request from Span Server in onmessage method()");var o=e.data;if(console.log("Received msg from span is ::: "+o),console.log("index of letrequest is::"+o.indexOf("dec.LetRequest")),-1!=o.indexOf("dec.LetRequest")){var t=JSON.parse(o),n=t["dec.LetRequest"];decodedData=decodeURIComponent(n.request.data),console.log("DecodedData::::"+decodedData);var r=JSON.parse(decodedData),l=r.component,s=r.nameSpace,a=r.value,c=r.options,i=r.method,u=r.eventType;console.log("component is:::: "+l),console.log("namespace is:::: "+s),console.log("value is:::: "+a),console.log("options is:::: "+c),console.log("method is:::: "+i),console.log("eventType is:::: "+u);var d="";d=null==s||0==s.length?l:l+"."+s;var p=getCurrentObject(l,s);if(null!=i&&"clear"===i){var g=c||null;console.log("Received Delete method call for NodeLevel = "+d+", leaf = "+p.isLeaf()),g?handleDeleteWithOptions(d,c,p.isLeaf(),p.isArray,p.isMap):handleDeleteWithNoOptions(d,p.isLeaf())}else if(p.isArray&&null!=a)console.log("Received component is of Array Type"),setItemsOfArrayType(d,a,c);else{console.log("Received component is of non Array Type");for(attrKey in a){attrVal=a[attrKey],console.log("ATTRIBUTE KEY::  "+attrKey),console.log("ATTRIBUTE VALUE::  "+attrVal);var f="";f=null==s||""==s?attrKey:s+"."+attrKey;var b=getCurrentObject(l,f);if(null!=b)if(b.isArray){var v=d+"."+attrKey;setItemsOfArrayType(v,attrVal,c)}else setItemsOfLeafOrNonLeafType(p,attrKey,attrVal);else console.log("Unable to get the current object for "+l+"."+f)}}executeSubscriptionCallbackForParentChild(d,a)}else console.log("Received Set dec request..ignoring...")},o.onclose=function(){console.log("Connection is closed...")},o.onerror=function(e){console.log("error is::"+e)}}else console.log("WebSocket NOT supported by your Browser!")}function getHashCode(e){var o=0;if(0==e.length)return o;for(i=0;i<e.length;i++)char=e.charCodeAt(i),o=(o<<5)-o+char,o&=o;return o}function createSubscriptionHandle(e){var o=getHashCode(e)+e;return o}function createDataHandle(e,o){var t=e+"."+o;return t}function getCurrentObject(e,o){var t=drive[e];if(null==o||0==o.length)return t;if(-1==o.indexOf("."))return t[o];for(var n=o.split("."),r=0;r<n.length;r++){var l=n[r];t=t[l]}return t}function executeSubscriptionCallbackForParentChild(e,o){console.log("Executing executeSubscriptionCallbackForParentChild for node::::"+e);for(var t=e.split("."),n="",r=o,l=t.length-1;l>=0;l--)if(console.log("Printing Node Value:::"+t[l]),l==t.length-1)executeSubscriptionCallbackAfterSet(e,o),n=e;else{var s=n.substring(n.lastIndexOf(".")+1),a={};a[s]=r,n=n.substring(0,n.lastIndexOf(".")),console.log("Execute Node :::::::"+n),console.log("NODE value to be sent"+JSON.stringify(a)),executeSubscriptionCallbackAfterSet(n,a),r=a}}function executeSubscriptionCallbackAfterSet(handle,value){var subscriptionHandle=createSubscriptionHandle(handle),isAlreadySubscribed=checkLocalSubscriptions(subscriptionHandle);if(isAlreadySubscribed){var fn=eval("("+localStorage.getItem(subscriptionHandle)+")");fn.call(null,value,EventType.GET)}else console.log("Component is not subscribed yet.So not sending subscription callback")}var connectionType="span",properties=getProperties();