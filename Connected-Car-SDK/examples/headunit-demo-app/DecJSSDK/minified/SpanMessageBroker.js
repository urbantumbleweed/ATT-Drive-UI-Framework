function RunSpanMessageBroker(){if("WebSocket"in window){console.log("WebSocket is supported by your Browser!");var uri="ws://"+properties.host+":"+properties.port+"/",ws=new WebSocket(uri);ws.onopen=function(){console.log("Web Scoket is connected now");var decSuccess=new DecSuccess("0","Successfully intialized the components and connected to span server"),callbackFn=drive.callback;if(null!=callbackFn){var fn=eval("("+callbackFn+")");fn.call(null,decSuccess)}},ws.onmessage=function(e){console.log("Received request from Span Server in onmessage method()");var o=e.data;if(console.log("Received msg from span is ::: "+o),console.log("index of letrequest is::"+o.indexOf("dec.LetRequest")),-1!=o.indexOf("dec.LetRequest")){var r=JSON.parse(o),n=r["dec.LetRequest"];decodedData=decodeURIComponent(n.request.data),console.log("DecodedData::::"+decodedData);var t=JSON.parse(decodedData),l=t.component,s=t.nameSpace,a=t.value,c=t.options,i=t.method,d=t.eventType;console.log("component is:::: "+l),console.log("namespace is:::: "+s),console.log("value is:::: "+a),console.log("options is:::: "+c),console.log("method is:::: "+i),console.log("eventType is:::: "+d);var u="";u=null==s||0==s.length?l:l+"."+s;var p=getCurrentObject(l,s);if(null!=i&&"clear"===i){var f=c||null;console.log("Received Delete method call for NodeLevel = "+u+", leaf = "+p.isLeaf());var g=null;f?(g=handleDeleteWithOptions(u,c,p.isLeaf(),p.isArray,p.isMap),console.log("Deleted Item ::: ",g)):(g=handleDeleteWithNoOptions(u,p.isLeaf(),p.isArray,p.isMap),console.log("Deleted Item ::: ",g)),null==a&&(a=g)}else if(p.isArray&&null!=a)console.log("Received component is of Array Type"),setItemsOfArrayType(u,a,c);else{console.log("Received component is of non Array Type");for(attrKey in a){attrVal=a[attrKey],console.log("ATTRIBUTE KEY::  "+attrKey),console.log("ATTRIBUTE VALUE::  "+attrVal);var v="";v=null==s||""==s?attrKey:s+"."+attrKey;var y=getCurrentObject(l,v);if(null!=y)if(y.isArray){var b=u+"."+attrKey;setItemsOfArrayType(b,attrVal,c)}else setItemsOfLeafOrNonLeafType(p,attrKey,attrVal);else console.log("Unable to get the current object for "+l+"."+v)}}executeSubscriptionCallbackForParentChild(u,a)}else console.log("Received Set dec request..ignoring...")},ws.onclose=function(){console.log("Connection is closed...")},ws.onerror=function(err){console.log("websocket connection to host "+properties.host+" port "+properties.port+" failed"),console.log("error is::"+err);var decError=new DecError(DecErrorCodes.span_not_found.errorcode,DecErrorCodes.span_not_found.errormessage),callbackFn=drive.callback;if(null!=callbackFn){var fn=eval("("+callbackFn+")");fn.call(null,decError)}}}else console.log("WebSocket NOT supported by your Browser!")}function getHashCode(e){var o=0;if(0==e.length)return o;for(i=0;i<e.length;i++)char=e.charCodeAt(i),o=(o<<5)-o+char,o&=o;return o}function createSubscriptionHandle(e){var o=getHashCode(e)+e;return o}function createDataHandle(e,o){var r=e+"."+o;return r}function getCurrentObject(e,o){var r=drive[e];if(null==o||0==o.length)return r;if(-1==o.indexOf("."))return r[o];for(var n=o.split("."),t=0;t<n.length;t++){var l=n[t];r=r[l]}return r}var connectionType="span",properties=getProperties();