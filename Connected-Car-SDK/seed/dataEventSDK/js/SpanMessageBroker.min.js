function RunSpanMessageBroker(){if("WebSocket"in window){console.log("WebSocket is supported by your Browser!");var uri="ws://"+properties.host+":"+properties.port+"/",ws=new WebSocket(uri);ws.onopen=function(){console.log("Web Scoket is connected now")},ws.onmessage=function(evt){console.log("Received request from Span Server in onmessage method()");var received_msg=evt.data;if(console.log("Received msg from span is ::: "+received_msg),console.log("index of letrequest is::"+received_msg.indexOf("dec.LetRequest")),-1!=received_msg.indexOf("dec.LetRequest")){var json=JSON.parse(received_msg),req=json["dec.LetRequest"];decodedData=decodeURIComponent(req.request.data),console.log("DecodedData::::"+decodedData);var jsonData=JSON.parse(decodedData),component=jsonData.component,namespace=jsonData.nameSpace,value=jsonData.value,options=jsonData.options,method=jsonData.method;console.log("component is:::: "+component),console.log("namespace is:::: "+namespace),console.log("value is:::: "+value),console.log("options is:::: "+options),console.log("method is:::: "+method);var nodeLevel="";nodeLevel=null==namespace||0==namespace.length?component:component+"."+namespace;var currentObject=getCurrentObject(component,namespace);if(null!=method&&"clear"===method){var filter=options||null;console.log("Received Delete method call for NodeLevel = "+nodeLevel+", leaf = "+currentObject.isLeaf()),filter?handleDeleteWithOptions(nodeLevel,options,currentObject.isLeaf(),currentObject.isArray,currentObject.isMap):handleDeleteWithNoOptions(nodeLevel,currentObject.isLeaf())}else if(currentObject.isArray&&null!=value)console.log("Received component is of Array Type"),setItemsOfArrayType(nodeLevel,value,options);else{console.log("Received component is of non Array Type");for(attrKey in value){attrVal=value[attrKey],console.log("ATTRIBUTE KEY::  "+attrKey),console.log("ATTRIBUTE VALUE::  "+attrVal);var newNameSpace="";newNameSpace=null==namespace||""==namespace?attrKey:namespace+"."+attrKey;var newCurrentObject=getCurrentObject(component,newNameSpace);if(null!=newCurrentObject)if(newCurrentObject.isArray){var thisNodeLevel=nodeLevel+"."+attrKey;setItemsOfArrayType(thisNodeLevel,attrVal,options)}else setItemsOfLeafOrNonLeafType(currentObject,attrKey,attrVal);else console.log("Unable to get the current object for "+component+"."+newNameSpace)}}var subscriptionHandle=createSubscriptionHandle(nodeLevel);console.log("subscriptionHandle from js "+subscriptionHandle);var fn=eval("("+localStorage.getItem(subscriptionHandle)+")");null!=fn?(console.log("calling callback function"),fn.call(null,value)):console.log(nodeLevel+" is not subscribed")}else console.log("Received Set dec request..ignoring...")},ws.onclose=function(){console.log("Connection is closed...")},ws.onerror=function(e){console.log("error is::"+e)}}else console.log("WebSocket NOT supported by your Browser!")}function getHashCode(e){var o=0;if(0==e.length)return o;for(i=0;i<e.length;i++)char=e.charCodeAt(i),o=(o<<5)-o+char,o&=o;return o}function createSubscriptionHandle(e){var o=getHashCode(e)+e;return o}function createDataHandle(e,o){var n=e+"."+o;return n}function getCurrentObject(e,o){var n=drive[e];if(null==o||0==o.length)return n;if(-1==o.indexOf("."))return n[o];for(var t=o.split("."),r=0;r<t.length;r++){var a=t[r];n=n[a]}return n}var connectionType="span",properties=getProperties();